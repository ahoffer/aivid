#!/bin/bash

set -e  # Exit on error

VENV_PATH=~/.venvs/vid

# Create virtual environment if it doesn't exist
if [ ! -d "$VENV_PATH" ]; then
    echo "Creating virtual environment at $VENV_PATH..."
    python3 -m venv "$VENV_PATH"
fi

# Activate virtual environment
source "$VENV_PATH/bin/activate"

# Install/upgrade pip
python3 -m pip install --upgrade pip > /dev/null 2>&1

# Install required dependencies
echo "Checking and installing dependencies..."
python3 -m pip install -q imageio numpy torch diffusers psutil nvidia-ml-py

# Run the video generation script
python3 vidgen.py village.json

echo "seconds=$SECONDS"